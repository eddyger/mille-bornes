{% extends "base.html.twig" %}

{% block body %}

<p> play game {{ game.name}}</p>

<p> Nb players <span id='nb-players' data-start-url='{{ path('app_game_start', {id: game.id}) }}'>{{ game.players | length}}</span></p>
{% if game.owner.id == app.user.id and game.state == 'open'  %}
{% set nbPlayers = game.players|length %}
  <p>
    <a href="{{ path('app_game_start', {id: game.id}) }}" id="button-start-game" class="button is-primary" {{ nbPlayers < 2 ? 'disabled="disabled"' : '' }}>Start</a>  
  </p>
{% endif %}

{% if engine is defined %}
{% set currentPlayer = engine.getCurrentPlayer() %}
  {% if currentPlayer.id == app.user.id and currentPlayer.getCardInHands()|length < 7 %}
    <p>
    <turbo-frame id='button-take-card-frame'>
      <a href="{{ path('app_game_take_card_in_deck', {id: game.id}) }}" id="button-take-card" class="button is-primary">Take card in deck</a>  
    </turbo>
    </p>
  {% endif %}
    
  {% for player in engine.players %}
    <div class="card">
      <header class="card-header">
        <p class="card-header-title">
        PLAYER = {{ player.id }}
        </p>
      </header>
      <div class="card-content">
        <div class="content">
         <div class="container">
         {% if app.user.id == player.id %}
         <turbo-frame id='player-cards'>
         {% endif %}
         
          {% for card in player.getCardInHands() %}
            <div class="{{ app.user.id == player.id ? 'dropzone draggable-dropzone--occupied' : ''}}">
              <div class="item" data-code={{card}}>
            ---{{ app.user.id == player.id ? card : 'BACK CARD' }}---
              </div>
            </div> 
          {% endfor %}
           {% if app.user.id == player.id %}
         </turbo-frame>
         {% endif %}
        
         </div> 
        </div>
      </div>    
    </div>
  {% endfor %}
  <turbo-frame id="play-zone">
    <div class="container">
      <div id='table' class="dropzone table"></div>
    </div>
    <div class="container">
      <div id='trash' class="dropzone trash">
      <img src="{{ asset('build/images/trash.png')}}" />
      </div>
    </div>
  </turbo>

  {% if currentPlayer.id == app.user.id %}
    <p>
    <turbo-frame id='button-play-frame'>
      <a href="{{ path('app_game_play_cards', {id: game.id}) }}" id="button-play-cards" class="button is-primary" data-turbo="false">Play the cards</a>  
    </turbo>
    </p>
  {% endif %}
  
{% endif %}



<div data-controller="play-controller" data-play-controller-url-value="{{ mercure(['#play-'~ game.id]) }}" data-play-controller-user-value="{{ app.user.id }}">
  <!-- ... -->
</div>

{% endblock %}